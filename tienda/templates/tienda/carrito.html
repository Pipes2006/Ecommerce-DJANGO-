{% extends 'tienda/base.html' %}

{% block content %}
<h2>Carrito de compras</h2>
<div id="carrito-lista"></div>
<div id="carrito-total"></div>
<div style="text-align:right; margin: 20px 40px 0 0;">
	<button id="btn-pagar" class="btn-agregar-carrito" style="font-size:1.1em; padding:10px 28px;">Pagar</button>
</div>
<script>
function renderCarrito() {
	let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
	let html = '';
	let total = 0;
	if (carrito.length === 0) {
		html = '<p>El carrito est√° vac√≠o.</p>';
	} else {
		html += '<table><tr><th>Imagen</th><th>Producto</th><th>Precio</th><th>Cantidad</th><th>Subtotal</th><th>Eliminar</th></tr>';
		carrito.forEach((item, idx) => {
			let subtotal = item.precio * item.cantidad;
			total += subtotal;
			let imgHtml = item.imagen ? `<img src="${item.imagen}" alt="${item.nombre}" width="60">` : '';
			html += `<tr><td>${imgHtml}</td><td>${item.nombre}</td><td>$${item.precio}</td><td>${item.cantidad}</td><td>$${subtotal.toFixed(2)}</td><td><button class='btn-eliminar' data-idx='${idx}'>üóëÔ∏è</button></td></tr>`;
		});
		html += '</table>';
	}
	document.getElementById('carrito-lista').innerHTML = html;
	document.getElementById('carrito-total').innerHTML = '<h3>Total: $' + total.toFixed(2) + '</h3>';
}
document.addEventListener('DOMContentLoaded', function() {
	renderCarrito();
	document.getElementById('carrito-lista').addEventListener('click', function(e) {
		if (e.target.classList.contains('btn-eliminar')) {
			let idx = parseInt(e.target.dataset.idx);
			let carrito = JSON.parse(localStorage.getItem('carrito')) || [];
			carrito.splice(idx, 1);
			localStorage.setItem('carrito', JSON.stringify(carrito));
			renderCarrito();
		}
	});
	document.getElementById('btn-pagar').addEventListener('click', function() {
		window.location.href = '/pago/';
	});
});
</script>
{% endblock %}
